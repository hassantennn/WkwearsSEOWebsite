import{w as L}from"./with-props-DVGQI9yc.js";import{j as o}from"./jsx-runtime-B1QxFx_A.js";import{r as q,i as H,L as J,u as X}from"./chunk-D4RADZKF-CYQil85_.js";import{j as _,q as k,s as G}from"./index-JEcTe66N.js";import{u as Q,P as z}from"./ProductPrice-wUdys-RI.js";import{I as M}from"./Image-Lob9_gmS.js";import"./Money-D5nHN9tR.js";const g=",",f={OPTION:":",END_OF_PREFIX:",",SEQUENCE_GAP:" ",RANGE:"-"},I=(()=>{const t=new Map;return function(e,n){var r;if(e.length===0)return!1;if(!t.has(n)){const s=new Set;for(const i of B(n)){s.add(i.join(g));for(let a=0;a<i.length;a++)s.add(i.slice(0,a+1).join(g))}t.set(n,s)}return!!((r=t.get(n))!=null&&r.has(e.join(g)))}})();function B(t){if(!t)return[];if(t.startsWith("v1_"))return Y(W(t));throw new Error("Unsupported option value encoding")}const W=t=>t.replace(/^v1_/,"");function Y(t){const e=/[ :,-]/g;let n=0,r;const s=[],i=[];let a=0,l=null;for(;r=e.exec(t);){const c=r[0],d=Number.parseInt(t.slice(n,r.index))||0;if(l!==null){for(;l<d;l++)i[a]=l,s.push([...i]);l=null}i[a]=d,c===f.RANGE?l=d:c===f.OPTION?a++:((c===f.SEQUENCE_GAP||c===f.END_OF_PREFIX&&t[r.index-1]!==f.END_OF_PREFIX)&&s.push([...i]),c===f.END_OF_PREFIX&&(i.pop(),a--)),n=e.lastIndex}const u=t.match(/\d+$/g);if(u){const c=parseInt(u[0]);if(l!=null)for(;l<=c;l++)i[a]=l,s.push([...i]);else s.push([c])}return s}function Z(t){return Object.assign({},...t.map(e=>({[e.name]:Object.assign({},...e!=null&&e.optionValues?e.optionValues.map((n,r)=>({[n.name]:r})):[])})))}function h(t){return Object.assign({},...t.map(e=>({[e.name]:e.value})))}function S(t){return JSON.stringify(h(t))}function T(t){return Array.isArray(t)?JSON.stringify(Object.assign({},...t.map(e=>({[e.name]:e.value})))):JSON.stringify(t)}function tt(t,e){return Object.keys(t).map(r=>e[r]?e[r][t[r]]:null).filter(r=>r!==null)}function et(t){return Object.assign({},...t.map(e=>({[T(e.selectedOptions||[])]:e})))}const R=["options","selectedOrFirstAvailableVariant","adjacentVariants"],nt=["handle","encodedVariantExistence","encodedVariantAvailability"];function m(t){return console.error(`[h2:error:getProductOptions] product.${t} is missing. Make sure you query for this field from the Storefront API.`),!1}function $(t,e=!1){var n;let r=!0;const s=Object.keys(t);if((e?[...R,...nt]:R).forEach(i=>{s.includes(i)||(r=m(i))}),t.options){const i=t==null?void 0:t.options[0];if(e&&!(i!=null&&i.name)&&(r=m("options.name")),(n=t==null?void 0:t.options[0])!=null&&n.optionValues){let a=t.options[0].optionValues[0];e&&!(a!=null&&a.name)&&(r=m("options.optionValues.name")),a=t.options[0].optionValues.filter(l=>!!(l!=null&&l.firstSelectableVariant))[0],a!=null&&a.firstSelectableVariant&&(r=y(a.firstSelectableVariant,"options.optionValues.firstSelectableVariant",r,e))}else r=m("options.optionValues")}return t.selectedOrFirstAvailableVariant&&(r=y(t.selectedOrFirstAvailableVariant,"selectedOrFirstAvailableVariant",r,e)),t.adjacentVariants&&t.adjacentVariants[0]&&(r=y(t.adjacentVariants[0],"adjacentVariants",r,e)),r?t:{}}function y(t,e,n,r){var s;let i=n;if(r&&!((s=t.product)!=null&&s.handle)&&(i=m(`${e}.product.handle`)),t.selectedOptions){const a=t.selectedOptions[0];a!=null&&a.name||(i=m(`${e}.selectedOptions.name`)),a!=null&&a.value||(i=m(`${e}.selectedOptions.value`))}else i=m(`${e}.selectedOptions`);return i}function rt(t){const e=$(t);if(!e.options)return[];const n={};e.options.map(s=>{var i;(i=s.optionValues)==null||i.map(a=>{if(a.firstSelectableVariant){const l=S(a.firstSelectableVariant.selectedOptions);n[l]=a.firstSelectableVariant}})}),e.adjacentVariants.map(s=>{const i=S(s.selectedOptions);n[i]=s});const r=e.selectedOrFirstAvailableVariant;if(r){const s=S(r.selectedOptions);n[s]=r}return Object.values(n)}function it(t){const e=$(t,!0);if(!e.options)return[];const{options:n,selectedOrFirstAvailableVariant:r,adjacentVariants:s,encodedVariantExistence:i,encodedVariantAvailability:a,handle:l}=e,u=r==null?void 0:r.selectedOptions.map(p=>p.name),c=n.filter(p=>u&&u.indexOf(p.name)>=0),d=Z(n),v=et(r?[r,...s]:s),j=h(r?r.selectedOptions:[]);return c.map((p,F)=>({...p,optionValues:p.optionValues.map(b=>{var E;const P={...j};P[p.name]=b.name;const U=T(P||[]),N=tt(P||[],d).slice(0,F+1),C=I(N,i||""),D=I(N,a||""),O=v[U]||b.firstSelectableVariant;let A={};O&&(A=h(O.selectedOptions||[]));const K=new URLSearchParams(A),V=((E=O==null?void 0:O.product)==null?void 0:E.handle)||l;return{...b,variant:O,handle:V,variantUriQuery:K.toString(),selected:j[p.name]===b.name,exists:C,available:D,isDifferentProduct:V!==l}})}))}function st(t){return q.useEffect(()=>{const e=new URLSearchParams(h(t||[])),n=new URLSearchParams(window.location.search),r=new URLSearchParams({...Object.fromEntries(n),...Object.fromEntries(e)});r.size>0&&window.history.replaceState({},"",`${window.location.pathname}?${r.toString()}`)},[JSON.stringify(t)]),null}function ot({image:t}){return t?o.jsx("div",{className:"product-image",children:o.jsx(M,{alt:t.altText||"Product Image",aspectRatio:"1/1",data:t,sizes:"(min-width: 45em) 50vw, 100vw"},t.id)}):o.jsx("div",{className:"product-image"})}function at({analytics:t,children:e,disabled:n,lines:r,onClick:s}){return o.jsx(_,{route:"/cart",inputs:{lines:r},action:_.ACTIONS.LinesAdd,children:i=>o.jsxs(o.Fragment,{children:[o.jsx("input",{name:"analytics",type:"hidden",value:JSON.stringify(t)}),o.jsx("button",{type:"submit",onClick:s,disabled:n??i.state!=="idle",children:e})]})})}function lt({productOptions:t,selectedVariant:e}){const n=H(),{open:r}=Q();return o.jsxs("div",{className:"product-form",children:[t.map(s=>s.optionValues.length===1?null:o.jsxs("div",{className:"product-options",children:[o.jsx("h5",{children:s.name}),o.jsx("div",{className:"product-options-grid",children:s.optionValues.map(i=>{const{name:a,handle:l,variantUriQuery:u,selected:c,available:d,exists:v,isDifferentProduct:j,swatch:x}=i;return j?o.jsx(J,{className:"product-options-item",prefetch:"intent",preventScrollReset:!0,replace:!0,to:`/products/${l}?${u}`,style:{border:c?"1px solid black":"1px solid transparent",opacity:d?1:.3},children:o.jsx(w,{swatch:x,name:a})},s.name+a):o.jsx("button",{type:"button",className:`product-options-item${v&&!c?" link":""}`,style:{border:c?"1px solid black":"1px solid transparent",opacity:d?1:.3},disabled:!v,onClick:()=>{c||n(`?${u}`,{replace:!0,preventScrollReset:!0})},children:o.jsx(w,{swatch:x,name:a})},s.name+a)})}),o.jsx("br",{})]},s.name)),o.jsx(at,{disabled:!e||!e.availableForSale,onClick:()=>{r("cart")},lines:e?[{merchandiseId:e.id,quantity:1,selectedVariant:e}]:[],children:e!=null&&e.availableForSale?"Add to cart":"Sold out"})]})}function w({swatch:t,name:e}){var s,i;const n=(i=(s=t==null?void 0:t.image)==null?void 0:s.previewImage)==null?void 0:i.url,r=t==null?void 0:t.color;return!n&&!r?e:o.jsx("div",{"aria-label":e,className:"product-option-label-swatch",style:{backgroundColor:r||"transparent"},children:!!n&&o.jsx("img",{src:n,alt:e})})}const jt=({data:t})=>[{title:`Hydrogen | ${(t==null?void 0:t.product.title)??""}`},{rel:"canonical",href:`/products/${t==null?void 0:t.product.handle}`}],bt=L(function(){const{product:e}=X(),n=k(e.selectedOrFirstAvailableVariant,rt(e));st(n.selectedOptions);const r=it({...e,selectedOrFirstAvailableVariant:n}),{title:s,descriptionHtml:i}=e;return o.jsxs("div",{className:"product",children:[o.jsx(ot,{image:n==null?void 0:n.image}),o.jsxs("div",{className:"product-main",children:[o.jsx("h1",{children:s}),o.jsx(z,{price:n==null?void 0:n.price,compareAtPrice:n==null?void 0:n.compareAtPrice}),o.jsx("br",{}),o.jsx(lt,{productOptions:r,selectedVariant:n}),o.jsx("br",{}),o.jsx("br",{}),o.jsx("p",{children:o.jsx("strong",{children:"Description"})}),o.jsx("br",{}),o.jsx("div",{dangerouslySetInnerHTML:{__html:i}}),o.jsx("br",{})]}),o.jsx(G.ProductView,{data:{products:[{id:e.id,title:e.title,price:(n==null?void 0:n.price.amount)||"0",vendor:e.vendor,variantId:(n==null?void 0:n.id)||"",variantTitle:(n==null?void 0:n.title)||"",quantity:1}]}})]})});export{bt as default,jt as meta};
